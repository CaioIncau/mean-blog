angular.module("myblog",["ngRoute","ngResource","ngSanitize"]).config(function($routeProvider,$httpProvider){$httpProvider.interceptors.push(function($q,$location){return{response:function(response){return response},responseError:function(response){return 401===response.status&&$location.url("/login"),$q.reject(response)}}});var checkLoggedin=function($q,$timeout,$http,$location,$rootScope){var deferred=$q.defer();return $http.get("/loggedin").success(function(user){"0"!==user?deferred.resolve():($rootScope.message="You need to log in.",deferred.reject(),$location.url("/"))}),deferred.promise};$routeProvider.when("/blog",{templateUrl:"partials/blog.html",controller:"HomeController"}),$routeProvider.when("/post",{templateUrl:"partials/formPost.html",resolve:{loggedin:checkLoggedin},controller:"HomeController"}),$routeProvider.when("/post/:postId",{templateUrl:"partials/formPost.html",resolve:{loggedin:checkLoggedin},controller:"HomeController"}),$routeProvider.when("/",{templateUrl:"partials/about.html",controller:"HomeController"}),$routeProvider.when("/about",{templateUrl:"partials/about.html",controller:"HomeController"}),$routeProvider.when("/work",{templateUrl:"partials/work.html",controller:"HomeController"}),$routeProvider.when("/skills",{templateUrl:"partials/skills.html",controller:"HomeController"}),$routeProvider.when("/contato",{templateUrl:"partials/contato.html",controller:"HomeController"}),$routeProvider.when("/login",{templateUrl:"partials/login.html",controller:"HomeController"})}),$(".fa-bars").on("click",function(e){$("nav a").slideToggle(),e.preventDefault()}),angular.module("myblog").controller("HomeController",["$scope","$routeParams","$resource",function($scope,$routeParams,$resource){var Post=$resource("/posts/:id");$routeParams.postId?Post.get({id:$routeParams.postId},function(post){$scope.post=post},function(){$scope.mensagem={texto:"Não foi possível obter o Post."}}):$scope.post=new Post,$scope.salva=function(){$scope.post.$save()},Post.query(function(posts){$scope.posts=posts})}]),angular.module("myblog").controller("LoginController",["$scope","$rootScope","$http","$location",function($scope,$rootScope,$http,$location){$scope.user={},$scope.login=function(){$http.post("/login",{username:$scope.user.username,password:$scope.user.password}).success(function(){$rootScope.message="Authentication successful!",$location.url("/blog")}).error(function(){$rootScope.message="Authentication failed.",$location.url("/login")})}}]),angular.module("myblog").factory("auth",function($q,$location){return{response:function(response){return response},responseError:function(response){return 401===response.status&&$location.path("/login"),$q.reject(response)}}});